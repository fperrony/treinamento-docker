sudo apt-get install -y nginx

/etc/init.d/nginx status

sudo nano /etc/nginx/sites-available/default

    root /home/treinamento/treinamento-docker/app/public;

    index index.php;

    location / {
        try_files $uri /index.php$is_args$args;
    }

    location ~ \.php {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        fastcgi_param SCRIPT_NAME $fastcgi_script_name;
        fastcgi_index index.php;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
    }

sudo /etc/init.d/nginx configtest

sudo tail -f /var/log/nginx/error.log

sudo /etc/init.d/nginx restart

### SSL

sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-treinamento.key -out /etc/ssl/certs/nginx-treinamento.crt
sudo openssl dhparam -out /etc/nginx/dhparam.pem 2048

sudo nano /etc/nginx/snippets/ssl.conf
    ssl_certificate /etc/ssl/certs/nginx-treinamento.crt;
    ssl_certificate_key /etc/ssl/private/nginx-treinamento.key;


sudo nano /etc/nginx/snippets/ssl-params.conf
    ssl_protocols TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_dhparam /etc/nginx/dhparam.pem;
    ssl_ciphers EECDH+AESGCM:EDH+AESGCM;
    ssl_ecdh_curve secp384r1;
    ssl_session_timeout  10m;
    ssl_session_cache shared:SSL:10m;
    ssl_session_tickets off;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 8.8.8.8 8.8.4.4 valid=300s;
    resolver_timeout 5s;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";



sudo nano /etc/nginx/sites-available/default
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;

    include snippets/ssl.conf;
    include snippets/ssl-params.conf;
